<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="dev.css" type="text/css">
<title>Developer Manual for TEAMMATES <br> Online Peer
	Evaluation and Peer Feedback System
</title>
</head>

<body>
	<div class="title">
		TEAMMATES <br> Online Peer Evaluation &amp; Peer Feedback System
		<br> [Developer Manual (DevMan)]
	</div>

	<br>
	<h3>Table of Contents</h3>
	<ul>
		<li><a href="#project">Project</a></li>
		<ul>
			<li><a href="#project-vision">Vision</a></li>
			<li><a href="#project-challenges">Challenges</a></li>
			<li><a href="#project-principles">Principles</a></li>
		</ul>

		<li><a href="#design">Design</a></li>
		<ul>
			<li><a href="#design-architecture">Architecture</a></li>
			<li><a href="#design-ui">UI</a></li>
			<li><a href="#design-logic">Logic</a></li>
			<li><a href="#design-storage">Storage</a></li>
			<li><a href="#design-common">Common</a></li>
			<li><a href="#design-testdriver">TestDriver</a></li>
			<li><a href="#design-client">Client</a></li>
		</ul>

		<li><a href="#infrastructure">Infrastructure</a>
			<ul>
				<li><a href="#infrastructure-knowledgebase">Knowledge base</a></li>
				<li><a href="#infrastructure-toolsandtechnologies-deployment">Deployment
						environment</a></li>
				<li><a href="#infrastructure-toolsandtechnologies-development">Development
						environment</a></li>
				<li><a
					href="#infrastructure-toolsandtechnologies-implementation">Tools
						used in implementation</a></li>
				<li><a href="#infrastructure-toolsandtechnologies-testing">Tools
						used in testing</a></li>
				<li><a href="#infrastructure-configpoints">Config points</a></li>
			</ul></li>
		<li><a href="#settingup">Setting Up</a></li>
		<ul>
			<li><a href="#settingup-prerequisites">Prerequisites</a></li>
			<li><a href="#settingup-settingupdevserver">Setting up the
					dev server</a></li>
			<li><a href="#settingup-deployingtostagingserver">Deploying
					to staging server</a></li>
			<li><a href="#settingup-troubleshooting">Troubleshooting</a></li>
		</ul>

		<li><a href="#process">Process</a></li>
		<ul>
			<li><a href="#process-roles">Roles</a></li>
			<li><a href="#process-workflow">Workflow</a></li>
			<li><a href="#process-fixingissues">Fixing issues</a></li>
			<li><a href="#process-reviewingafix">Reviewing a fix</a></li>
			<li><a href="#process-applyingafix">Applying a fix</a></li>
			<li><a href="#process-deployingfixes">Deploying fixes</a></li>
			<li><a href="#process-issuelifecycle">Issue Lifecycle</a></li>
		</ul>

		<li><a href="#glossary">Glossary</a></li>
	</ul>

	<hr>
	<!-- =============================================================== -->

	<h1 id="project">Project</h1>

	<h2 id="project-vision">Vision</h2>

	Long term goal: Become the
	<span class="bold">biggest student project in the world</span>.
	<br> {Biggest = many contributors, many users, relatively large
	code base (50k-100k LoC), evolving over a long period.}
	<br>
	<br> 'Biggest' above also implies an exceptionally high quality
	standard because high quality is a necessity for the long-term survival
	of a big student project.
	<br>
	<br> This project will also serve as a model and a training ground
	for Software Engineering (SE) students who want to learn SE skills in
	the context of a non-trivial real software product.
	<br>

	<h2 id="project-challenges">Challenges</h2>
	The project differs from typical student projects in the following
	areas, which makes it more challenging and the experience more
	enriching.
	<br>
	<ul>
		<li><span class="bold">Developers</span>: All developers are
			novices and their involvement with the project is short term and part
			time.</li>
		<li><span class="bold">Code</span>: Working with legacy code
			written by past developers is harder than writing from scratch.</li>
		<li><span class="bold">Data</span>: The data in the live system
			are confidential and developers are not allowed to see them. This
			makes troubleshooting harder.</li>
		<li><span class="bold">Releases</span>: Frequent releases to an
			active user database requires us to maintain 'production quality'
			constantly.</li>
		<li><span class="bold">Platform</span>: TEAMMATES is running on
			Google App Engine cloud platform, which adds the following
			challenges.
			<ul>
				<li>It is an emerging platform evolving rapidly. We have to
					keep up.</li>
				<li>It imposes various restrictions on the application. e.g.
					Each request to the app has be served within 60 seconds.</li>
				<li>It charges us based on usage. We have to optimize usage.</li>
			</ul></li>
		<li><span class="bold">Software Engineering</span>: As TEAMMATES
			serve as a model system for training students, it should also focus
			on applying good 'Software Engineering' techniques.</li>
	</ul>

	<h2 id="project-principles">Principles</h2>
	We apply these principles to meet the challenges stated above.
	<br>
	<ul>
		<li><span class="bold">We keep moving forward, always</span>: We
			release frequently, in weekly <a
			href=http://en.wikipedia.org/wiki/Timeboxing">time-boxed
				iterations</a>. Every week, our product becomes better than the previous
			week. This means 'go back and rewrite from scratch' is only a last
			resort.</li>
		<li><span class="bold">We are agile</span>: We are able to change
			the system quickly and with ease to match emerging requirements. We
			aim for minimal yet sufficient documentation.</li>
		<li><span class="bold">We defend our code with tests,
				fiercely</span>: Since we practice <a
			href="http://www.extremeprogramming.org/rules/collective.html">collective
				code ownership</a>, we have to make sure the code is not accidentally
			broken by others. We use fully automated regression testing. The
			testing automation level of this project is probably higher than 99%
			of the projects out there.</li>
		<li><span class="bold">We are 'Gods' of the few tools we
				use</span>: We stick to a minimal toolset. Adding third-party tools and
			libraries to the project is done only if there is a STRONG
			justification. Only mature, stable, and well-supported tools should
			be considered. Once selected, we should know the tool very well to
			get the best out of it.</li>
		<li><span class="bold">We value quality more than
				functionality</span>: Our job is not to 'anyhow get it to work'. The
			system should be good enough to be considered a 'model' software. Our
			code should be of 'unusually' high quality: All code is reviewed before
			accepting.</li>
		<li><span class="bold">We know what we are doing</span>: For us,
			it is not enough to know something is broken, we should also know why
			it is broken. It is not enough to get something working, we should
			know how we got it to work.</li>
		<li><span class="bold">We seek the best, not stop at the
				first</span>: We do not settle for the first workable method to solve a
			problem. We study other ways of solving it and decide what is the
			best way for us.</li>
		<li><span class="bold">We take pains to save the team from
				pain</span>: Whenever we had to spend effort in figuring out something, we
			refine code/documents so that others don't have to go through the
			same pain. Whenever we figured out a less painful way of doing
			something, we make sure everyone in the team learn it too.</li>
	</ul>
	<hr>
	<!-- =============================================================== -->

	<h1 id="design">Design</h1>

	<h2 id="design-architecture">Architecture</h2>

	<div class="image-holder">
		<img src="images/highlevelArchitecture.png" width="90%" />
	</div>

	<br> TEAMMATES is a Web app that runs on Google App Engine (GAE)
	cloud platform. Given above is an overview of the main components.
	<br>

	<ul>
		<li><span class="bold">UI</span>: The UI seen by users consists
			of Web pages containing HTML, CSS (for styling) and JavaScripts (for
			client-side interactions such as sorting, input validation etc.).
			This UI is generated by Java Server Pages (JSP) and Java Servlets
			residing on the server. Requests are sent to the server over normal
			HTTP. In future, AJAX may be used sparingly to fetch data from the
			server asynchronously.</li>
		<li><span class="bold">Logic</span>: The main logic of the app is
			in Java POJOs (Plain Old Java Objects). Some automated tasks are
			implemented as Servlets.</li>
		<li><span class="bold">Storage</span>: Storage uses the
			persistence framework provided by GAE 'datastore'. While the
			datastore is a noSQL database, we use it in SQL fashion via a JDO
			wrapper and GQL (a datastore-specific SQL variant).</li>
		<li><span class="bold">Test Driver</span>: TEAMMATES makes heavy
			use of automated regression testing. TestNG is used for Java unit
			testing and QUnit for JavaScript unit testing. We use Selenium Web
			Driver to automate UI testing. Test Driver can access the application
			directly to set up test data. We use JSON format to transmit such
			data to the application.</li>
		<li><span class="bold">Client</span>: The Client component can
			connect to the back end directly without using a Browser. It is used
			for administrative purposes. e.g., migrating data to a new schema</li>
		<li><span class="bold">Common</span>: The Common component
			contains utility code used across the application.</li>
	</ul>
	The diagram below shows how the code is organized into packages inside
	each component and dependencies among them.
	<div class="image-holder">
		<img class="image" src="images/packageDiagram.png" width="90%" />
	</div>
	<br> Notes:
	<ul>
		<li>[logic] - [ui::view] - [ui::controller] represent an
			application of Model-View-Controller pattern.</li>
		<li>ui::view and ui::website packages are not Java packages. They
			consist of jsp, html, js and css files.</li>
	</ul>


	<h2 id="design-ui">UI</h2>
	<div class="image-holder">
		<img class="image" src="images/UiComponent.png" width="90%" />
	</div>
	<br>

	<h3>Request flow</h3>
	Request from the Browser will go through following steps:
	<br></br>

	<div class="image-holder">
		<img src="images/UiWorkflow.png" width="90%"></img>
	</div>

	<ol>
		<li>Request received by the GAE server</li>
		<li>Forwarded to our custom filters according to the order
			specified in <span class="code">web.xml</span>. In our case this
			would be <span class="code">DatastoreFilter</span> and <span
			class="code">LoginFilter</span>. For example, the <span class="code">LoginFilter</span>
			will forward any request from not-logged-in users to the login page.
			If the request is from logged in user, then it will proceed according
			to the URL.
		</li>
		<li>Depending on the URL, it will be handled by its respective
			Servlet (e.g., <span class="code">InstructorHomeServlet</span>, <span
			class="code">InstructorCourseDeleteServlet</span>, etc).
		</li>
		<li>The servlet will communicate with the <span class="code">Logic</span>
			to carry out the business logic part of the requst (e.g., accessing
			datastore, modifying datastore, etc). After that, it will create
			respective <span class="code">Helper</span> object and store inside
			that object relevant data retrieved from the <span class="code">Logic</span>
			(e.g., student list, course list, evaluation data, etc).
		</li>
		<li>The respective Helper object then will be passed to the
			respective JSP page.</li>
		<li>The JSP page will then render the page according to the data
			inside the <span class="code">Helper</span> object.
		</li>
		<li>The response will then be sent back to the Browser, which
			will render the page.</li>
	</ol>

	<h3>Process flow in Servlets</h3>
	Since the request will undergo mostly similar processing steps, the
	request will first be processed in the general-purpose abstract class
	<span class="code">ActionServlet</span> (this is an application of the
	<a href="http://en.wikipedia.org/wiki/Template_method_pattern">Template
		Method pattern</a>). This is the sequence of steps taken by the
	<span class="code">ActionServlet</span> object:
	<ol>
		<li>Check whether the request method is <span class="code">POST</span>
			or <span class="code">GET</span>, store it in a variable <span
			class="code">isPost</span>.
		</li>
		<li>Call abstract <span class="code">instantiateHelper</span>
			method, which should have been overridden to create respective <span
			class="code">Helper</span> object.
		</li>
		<li>Call concrete <span class="code">prepareHelper</span> method,
			which will setup common data inside the <span class="code">Helper</span>
			object, such as the <span class="code">Logic</span> object, <span
			class="code">UserData</span> object, redirect URL, status message and
			error status. This method will also set and configure the masquerade
			mode if required ('masquarade mode' is used by the administrator to
			masquerade as another user).
		</li>
		<li>It will call the abstract <span class="code">doAction</span>
			method, which should have been overridden to contain the main action
			for each servlet. This is the place for highest-level error handling
			before the response is returned to the Browser.
		</li>
		<li>Within the <span class="code">doAction</span> method, each
			servlet has to create an Activity Log Entry. This Activity Log Entry
			is used to capture the user activities within the system. The servlet
			has to call the <span class="code">instantiateActivityLogEntry
			</span> method found in <span class="code">ActionServlet</span> to create the
			Activity Log Entry. The servlet also has to implement the abstract <span
			class="code">generateActivityLogEntryMessage</span> method which is
			called within <span class="code">instantiateActivityLogEntry</span>.
		</li>
		<li>It will finally call <span class="code">doCreateResponse</span>
			method, which redirects the request with appropriate method: either
			forward the request using <span class="code">requestDispatcher</span>
			to the page specified in <span class="code">getDefaultForwardUrl</span>
			or redirect the request to the page as specified in variable <span
			class="code">redirectUrl</span>.
		</li>
	</ol>
	When adding new pages to the app, the developer just need to subclass
	the
	<span class="code">ActionServlet</span> class and implement the
	abstract methods (and override
	<span class="code">getDefaultForwardUrl</span>) accordingly. The
	<span class="code">Helper</span> class can also be subclassed if the
	default one is not enough (most likely).
	<br>
	<br> The UI consist of following pages:

	<h3>Functional pages</h3>
	These pages represent the core functionality of the system.
	<ol>
		<li><span class="code">logout.jsp</span> : Used for users to log out of the system.</li>
		<br>
		<li><span class="code">adminHome</span> : Home page for admin. Also used for creating instructors.</li>
		<li><span class="code">adminAccountManagement</span> : Page for managing accounts etc.</li>
		<li><span class="code">adminAccountDetails</span> : Page for viewing account details etc.</li>
		<li><span class="code">adminActivityLog</span> : Page for monitoring user activities.</li>
		<li><span class="code">adminSearch</span> : Page for searching for entity in the system.</li>
		<br>
		<li><span class="code">instructorHome</span> : Landing page for instructors. Lists course
			and evaluations that the instructor is part of</li>
		<li><span class="code">instructorCourse</span> : Page for Course-related actions.</li>
		<li><span class="code">instructorCourseEdit</span> : Page to edit course information and
			Instructor list</li>
		<li><span class="code">instructorCourseEnroll</span> : Page for enrolling students in a
			course</li>
		<li><span class="code">instructorCourseView</span> : Page for listing students in a course.</li>
		<li><span class="code">instructorCourseStudentDetails</span> : Page for viewing details of
			an individual student.</li>
		<li><span class="code">instructorCourseStudentEdit</span> : Page for editing details of a
			student.</li>
		<li><span class="code">instructorEval</span> : Page for listing and creating Evaluations.</li>
		<li><span class="code">instructorEvalEdit</span> : Page for editing an Evaluation.</li>
		<li><span class="code">instructorEvalResults</span> : Page for viewing evaluation results.</li>
		<li><span class="code">instructorEvalSubmissionView</span> : Page for viewing submissions
			from and to a student for a given evaluation.</li>
		<li><span class="code">instructorEvalSubmissionEdit</span> : Page for editing a submission
			by a student.</li>
		<br>
		<li><span class="code">studentHome</span> : Landing page for students.</li>
		<li><span class="code">studentCourseDetails</span> : Page for the student to see details of
			his/her team in a Course.</li>
		<li><span class="code">studentEvalEdit</span> : Page for submitting a peer evaluation.</li>
		<li><span class="code">studentEvalResults</span> : Page for viewing evaluation results.</li>
	</ol>

	These pages can be accessed via the
	<span class="code">[TEAMMATES URL]/page/pagename</span>, handled by a
	Servlet and a jsp page named after the page name.
	<br> e.g.,
	<span>adminHome</span> can be reached by
	<a href="http://teammatesv4.appspot.com/admin/adminHome">http://teammatesv4.appspot.com/admin/adminHome</a>
	and is handled by
	<span class="code">AdminHomeServlet.java</span> and
	<span class="code">adminHome.jsp</span>
	<br>
	<br> Only logged in users can access these pages.
	<span class="code">LoginFilter.java</span> is used to redirect
	not-logged-in users to a login page.
	<br>
	<br>

	<h3>Special-purpose pages</h3>
	These pages provide peripheral functionality.These pages are not
	access-controlled.
	<ul>
		<li>studentHelpPage (an html page)</li>
		<li>instructorHelpPage (an html page)</li>
		<li>error pages (errorPage.jsp, mobile.jsp, oldIE.jsp, etc.)</li>
	</ul>

	<h3>Website pages</h3>
	These are the static pages that forms the product website (not the
	product itself).
	<ul>
		<li>contact.html, about.html etc.</li>
	</ul>


	<h2 id="design-logic">Logic</h2>

	The
	<span class="code">Logic</span> component handles the business logic of
	TEAMMATES.
	<br> It is accessible via a thin 
	<a href="http://en.wikipedia.org/wiki/Facade_pattern">facade class</a> called
	<span class="code">Logic</span> which makes use of several
	<span class="code">*Logic</span> classes to handle the logic related to
	various types of data and to access data from the
	<span class="code">Storage</span> component. In particular, Logic is 
	responsible for these: <br>
	<ul>
		<li>Managing relationships between entities. e.g., cascade logic
			for create/update/delete</li>
		<li>Managing transactions. e.g., to ensure atomicity of a
			transaction</li>
		<li>Sanitizing input values recevied from the UI component</li>
		<li>Access control (to be moved to the UI component soon)</li>
	</ul>

	<div class="image-holder">
		<img src="images/LogicComponent.png" width="90%" />
	</div>
	<br>

	<h3>Logic API</h3>
	Represented by
	<span class="code">Logic.java</span> and
	<span class="code">BackDoorServlet.java</span>
	<ul>
		<li><span class="code">Logic</span>: For the use of UI. <span
			class="code">Logic</span> class acts as a facade between UI
			(servlets) and the backend of the app.</li>
		<li><span class="code">BackDoorLogic</span>: For the use of <span
			class="code">TestDriver</span> (via <span class="code">BackDoorServlet</span>)</li>
	</ul>

	<h3>Policies</h3>
	General:
	<br>
	<ul>
		<li>Null values should <span class="bold">not</span> be used as
			parameters to this API, except when following the KeepExisting policy
			(explained later).
		</li>
	</ul>

	<br>Access control:
	<ul>
		<li>Calls received by <span class="code">Logic</span> are
			checked against logged in user's privileges
			(to be moved to UI layer).<br>
		</li>
		<li>Calls received by <span class="code">BackDoorServlet</span>
			are authenticated using the 'backdoor key'. Backdoor key is a string
			known only to the person who deployed the app (typically, the
			administrator).
		</li>
	</ul>
	<br>API for creating entities:
	<ul>
		<li>Null parameters: Causes an assertion failure.</li>
		<li>Invalid parameters: Throws <span class="code">InvalidParametersException</span>.</li>
		<li>Entity already exists: Throws <span class="code">EntityAlreadyExists</span>
			exception (escalated from <span class="code">Storage</span> level).
		</li>
		<li>When creating <span class="code">Evaluations</span>, <span
			class="code">Submission</span> entities are automatically created at
			the time of creating an evaluation or changing the team structure of
			a course.
		</li>
	</ul>
	<br>API for retrieving entities:
	<ul>
		<li>Attempting to retrieve objects using <span class="code">null</span>
			parameters: Causes an assertion failure.
		</li>
		<li>Entity not found: <br> -Returns <span class="code">null</span>
			if the target entity not found. This way, read operations can be used
			easily for checking the existence of an entity.<br> -Throws <span
			class="code">EntityDoesNotExistsExeption</span> if a parent entity
			of a target entity is not found e.g., trying to list students of a
			non-existent course.
		</li>
	</ul>
	<br>API for editing entities:
	<ul>
		<li>Primary keys cannot be edited except: <span class="code">Student.email</span>
		</li>
		<li>KeepExistingPolicy: the new value of an optional attribute is
			specified as <span class="code">null</span> or set to
			“Uninitialized”, the existing value will prevail. {This is not a good
			policy. To be reconsidered}
		</li>
		<li><span class="code">Null</span> parameters: Throws an
			assertion error if that parameter cannot be null. Optional attributes
			follow KeepExistingPolicy</li>
		<li>Entity not found: Throws <span class="code">EntityDoesNotExistException</span>
			exception
		</li>
		<li>Invalid parameters: Throws <span class="code">InvalidParametersException</span>
		</li>
	</ul>

	<br>API for deleting entities:
	<ul>
		<li><span class="code">Null</span> parameters: Not expected.
			Results in assertion failure.</li>
		<li>FailDeleteSilentlyPolicy: In general, delete operation do not
			throw exceptions if the target entity does not exist. Instead, it
			logs a warning. This is because if it does not exist, 
			it is as good as deleted.</li>
		<li>Cascade policy: When a parent entity is deleted, entities
			that have referential integrity with the deleted entity should also
			be deleted. <br> Refer to the API for the cascade logic.
		</li>
	</ul>
	<h2 id="design-storage">Storage</h2>

	The
	<span class="code">Storage</span> component performs CRUD (Create,
	Read, Update, Delete) operations on data entities individually. It is
	accessible via the
	<span class="code">*Db</span> classes in the
	<span class="code">storage::api</span> package. 
	<br>It contains minimal logic beyond what is directly relevant to
	CRUD operations. <br> In particular, it handles these:
	<ul>
		<li>Validating data inside entities before creating/updating
			them, to ensure they are in a valid state.</li>
		<li>Hiding the complexities of datastore from the <span
			class="code">Logic</span> component. All GQL queries are to be
			contained inside the <span class="code">Storage</span> component.
		</li>
		<li>Protecting persitable objects: Classes in the <span
			class="code">storage::entity</span> package are not visible outside
			this component to prevent accidental modification to the entity's
			attributes (Since these classes have been marked as 'persistence
			capable', and changes to their attributes are automatically persisted
			to the datastore by default). <br> Instead, a corresponding
			non-persistent <a
			href="http://en.wikipedia.org/wiki/Data_transfer_object">data
				transfer object</a> named <span class="code">*Attributes</span> (e.g., <span
			class="code">CourseAttributes</span> is the data transfer object for
			<span class="code">Course</span> entities) object is returned, where
			values can be get and set easily without any impact on the persistent
			data copy. These datatransfer classes are in <span class="code">common::datatransfer</span>
			package explained later. Note: This decision was taken before GAE
			started supporting <a
			href="https://developers.google.com/appengine/docs/java/datastore/jdo/creatinggettinganddeletingdata">
				the ability to 'detach' entities </a> to prevent accidental
			modifications to persistable data. The decision to use data transfer
			objects is to be reconsidered in the future.
		</li>
	</ul>
	The <span class="code">Storage</span> component will not perform any
	cascade delete/create operations.Cascade logic is currently handled by
	the <span class="code">Logic</span> component.
	<br>  

	<div class="image-holder">
		<img src="images/StorageComponent.png" width=80% />
	</div>

	
	<br> Note that the navigability of the association links between
	entity objects appear to be in the reverse direction of what we see in
	a normal OOP design. This is because we want to keep the data scheme
	flexible so that new entity types can be added later with minimal
	modifications to existing elements.

	<h3>Storage API</h3>
	Represented by classes in
	<span class="code">storage::api</span>

	<h3>Policies</h3>
	Add and Delete operations try to wait until data is persisted in the
	datastore before returning. This is not enough to compensate for
	eventual consistency involving multiple servers in the GAE production
	enviornment. However, it is expected to avoid test failures caused by
	eventual consistency in dev server and reduce such problems in the live server.
	<br> Note: 'Eventual consistency' here means it takes some time
	for a database operation to propagate across all serves of the Google's
	distributed datastore. As a result, the data may be in an inconsistent
	states for short periods of time although things should become
	consistent 'eventually'. For example, an object we deleted may appear
	to still exist for a short while.
	<br>
	<br> Implementation of Transaction Control has been decided
	against due to limitations of GAE environment and the nature of our
	data schema. Please see
	<a
		href="https://docs.google.com/document/pub?id=1o6pNPshCp9S31ymHY0beQ1DVafDa1_k_k7bpxZo5GeU&embedded=true">TEAMMATES
		Decision Analysis </a> document for more information.
	<br>
	<br> General:
	<br>
	<ul>
		<li>If <span class="code">Null</span> is passed as a parameter,
			the corresponding value is <span class="bold">NOT</span> modified, as
			per the KeepExistingPolicy that was previously mentioned.
		</li>
	</ul>
	<br> API for creating:
	<ul>
		<li>Attempt to create an entity that already exists: Throws <span
			class="code">EntityAlreadyExists</span> exception.
		</li>
		<li>Attempt to create an entity with invalid data: Throws <span
			class="code">InvalidParametersException</span></li>
	</ul>
	<br> API for retrieving:
	<ul>
		<li>Attempt to retrieve an entity that does not exist: Returns <span
			class="code">null</span>.
		</li>
	</ul>
	<br> API for updating:
	<ul>
		<li>Attempt to update an entity that does not exist: Throws <span
			class="code">EntityDoesNotExistException</span>.
		</li>
		<li>Attempt to update an entity with invalid data: Throws <span
			class="code">InvalidParametersException</span></li>
	</ul>
	<br> API for deleting:
	<ul>
		<li>Attempt to delete an entity that does not exist: Fails silently.</li>
	</ul>


	<h2 id="design-common">Common</h2>

	<div class="image-holder">
		<img src="images/CommonComponent.png" width=90% />
	</div>
	<br> The Common component contains common utilities used across
	TEAMMATES.
	<br>
	<span class="code">common::Common.java</span> currently holds a vast
	collection of common constants and functions. This is a good candidate
	for breaking into smaller classes.
	<br>
	<br>
	<span class="code">common::datatransfer</span> package contains
	lightweight 'data transfer object' classes for transferring data among components. 
	They can be combined in various ways to transfer structured data between
	components. Given below are three examples.
	<br>
	<div class="image-holder">
		<img src="images/dataTransferClasses.png" width=90% />
	</div>
	<br> (a)
	<span class="code">Test Driver</span> can use the
	<span class="code">DataBundle</span> in this manner to send an
	arbitrary number of objects to be persisted in the database.
	<br> (b) This structure can be used to transfer data of a course
	 (e.g., when constructing the home page for an
	instructor).
	<br> (c) This structure can be used to send results of an
	evaluation (e.g., when showing an evaluation report to an instructor)
	<br>
	<br> For convenience, these classes use public variables for data.
	This is not a good practice as it contravenes OO principle of
	<i>information hiding</i> and increases the risk of inconsistent data.
	This strategy is to be reconsidered at a later date.
	<br>


	<h2 id="design-testdriver">TestDriver</h2>
	This component automates the testing of TEAMMATES.
	<br>
	<div class="image-holder">
		<img src="images/TestDriverComponent.png" width=90% />
	</div>
	<br> We have two kinds of automated test cases:
	<ul>
		<li>Component tests: Some of these are pure unit tests (i.e.,
			test one component in isolation) while others are integration tests
			that tests units as well as integration of units with each other.<br>
			<span class="code">AllJsTests.java</span> is for unit testing
			JavaScript code.
		</li>
		<li>UI tests: These focus on testing the UI and the integration
			of all components with the UI.</li>
	</ul>
	This is how TEAMMATES testing maps to standard types of testing.
	<br>
	<br>
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Normal:
	<span style="background: #A4C2F4">|---------acceptance
		tests----|---system tests----|-----integration tests-----|-------unit
		tests----------|</span>
	<br> TEAMMATES:
	<span style="background: #F4CCCC">|---------manual
		testing-------------|</span>
	<span style="background: #B6D7A8">----automated UI
		tests----|---automated component tests ---|</span>
	<br>
	<br>
	<br> Notable classes/files:
	<ul>
		<li><span class="code"><span class="bold">testing.xml</span></span>
			contains the testNG test configuration.</li>
		<li><span class="code"><span class="bold">BrowserInstance.java</span></span>
			represents the UI of the application. It is a wrapper around Selenium
			Web Driver. It allows the test driver to simulate user actions on the
			TEAMMATES UI. This class is a good candidate for further
			decomposition as it is too big at the moment.<br> Notable
			methods and data members (<span class="bold">IMPORTANT</span>):
			<ul>
				<li><span class="code">get[entity]RowID</span>: to find the
					rowID of some specific entity on a specific page.</li>
				<li><span class="code">get[entity]LinkLocator</span>: to
					retrieve the locator (a By object) of an entity. This method
					usually have two versions, one accepting primary key to that
					entity, the other accepting rowID. The basic form is the one
					accepting rowID.</li>
				<li>Data member of By type: gives the locator of an entity
					which does not require any parameter to be retrieved (such as input
					textbox for course ID in creating course)</li>
				<li><span class="code">click[entity]</span>: methods to click
					on some object on the page. This is only convenience method as it
					can be replaced by calling <span class="code">click(By
						locator)</span> using locator as retrieved from the <span class="code">get*LinkLocator</span>.</li>
				<li><span class="code">count[entity]</span>: to count the
					number of that entity in the page (e.g., number of students, number
					of evaluations, etc)</li>
				<li><span class="code">get[entity]</span> and <span
					class="code">studentGet[entity]</span>: method to retrieve some
					information on the page. For some cases, this is only convenience
					method as it can be replaced by calling <span class="code">getText(By
						locator)</span> with respective locator, for others, it uses more
					sophisticated method to retrieve the data easier and faster.</li>
				<li>Methods related to form-filling such as <span class="code">fillString</span>,
					<span class="code">fillInCourseID</span>, <span class="code">addEvaluation</span>,
					<span class="code">addCourse</span>. These methods are there to
					make filling forms easier, as well as giving model to new
					developers on how to fill the forms.
				</li>
				<li>There are also some verification methods to test the page
					HTML.</li>
			</ul></li>
		<li><span class="code"><span class="bold">BackDoor.java</span></span>
			allows test driver to communicate with the TEAMMATES datastore. It
			hides from Test Driver the complexity of HTTP communication that is
			required to interact with the server.
		<li><span class="code"><span class="bold">EmailAccount.java</span></span>
			allows Test Driver to query email accounts of test users (e.g., to
			verify the receipt of emails sent by TEAMMATES)
		<li><span class="code"><span class="bold">TestProperties.java</span></span>
			represents configuration values in test.properties and
			appengine-web.xml that are useful for testing. e.g., the app version
			number that we expect to see in the UI footer.
	</ul>
	
	<h2 id="design-client">Client</h2>

	<br> The Client component contains scripts that can connect to the application
	backend for things such as migrating data and calculating statistics.
	<br>
	<span class="code">client::remoteapi</span> package contains the classes need to 
	connect to the backend directly.
	<br>
	<span class="code">client::scripts</span> package contains
	scripts that does things with the back end data.
	<br>

	<hr>
	<!-- =============================================================== -->

	<h1 id="infrastructure">Infrastructure</h1>

	<h2 id="infrastructure-knowledgebase">Knowledge base</h2>

	<ul>
		<li>Is available at our <span class="bold">developer website</span> : <a
			href="http://code.google.com/p/teammatespes">teammatesPES.googlecode.com</a>
			{PES = Peer Evaluation System}</li>
	</ul>


	<h2 id="infrastructure-toolsandtechnologies-deployment">Deployment
		environment</h2>
	<ul>
		<li><span class="bold">Google App Engine (GAE)</span></li>
		<li><span class="bold">Java</span> [version 1.7, this is the
			highest version supported by GAE]</li>
		<li><span class="bold">Live site</span>: <a
			href="http://teammatesv4.appspot.com/">http://teammatesv4.appspot.com</a></li>
	</ul>

	<h2 id="infrastructure-toolsandtechnologies-development">Development
		environment</h2>
	<ul>
		<li><span class="bold">Eclipse</span> IDE for EE developers
			[version juno]</li>
		<li><span class="bold">Google App Engine Plugin for
				Eclipse</span> [version 4.2]</li>
		<li><span class="bold">Google App Engine SDK</span> [version
			1.7.7.1]</li>
		<li><span class="bold">TortoiseHg</span> or Mac OS equivalent
			[version: latest stable]</li>
		<li><span class="bold">Google Code</span> project hosting.</li>
		<li><span class="bold"><a
				href="https://codereview.appspot.com">Rietveld</a></span> Code Review
			System.</li>
	</ul>

	<h2 id="infrastructure-toolsandtechnologies-implementation">Tools
		used in implementation</h2>
	<ul>
		<li><span class="bold">HTML</span> [version 5, using latest
			features is discouraged due to lack of enough Browser support], <span
			class="bold">JavaScript</span>, <span class="bold">CSS</span></li>
		<li><a class="bold" href="http://jquery.com/">jQuery</a> </span>
			[version 1.8.3] <br>jQuery is a JavaScript Library that
			simplifies HTML document traversing, event handling, animating, and
			Ajax interactions for rapid web development.</li>
		<li><span class="bold">JSON </span><span>(JavaScript
				Object Notation) <br>JSON is a lightweight data-interchange
				format. It is easy for humans to read and write. It is easy for
				machines to parse and generate. It is based on a subset of the
				JavaScript. </li>
		<li><a class="bold" href="http://code.google.com/p/google-gson/">Gson</a></span>
			[version 2.2.2] <br>Gson is a Java library that can be used to
			convert Java Objects into their JSON representation. It can also be
			used to convert a JSON string to an equivalent Java object.</li>
		<li><span class="bold">Java Server Pages (JSP)</span> <br>JSP
			technology provides a simplified way to create dynamic web content. A
			JSP page can be thought as an HTML page with embedded Java code
			snippets.</li>
		<li><span class="bold">Java Servlets</span> <br>Java Servlet
			technology provides a simple, consistent mechanism for extending the
			functionality of a Web server and for accessing existing business
			systems. A servlet can almost be thought of as an applet that runs on
			the server side--without a face.</li>
		<li><span class="bold"><a
				href="https://developers.google.com/appengine/docs/java/datastore/jdo/overview">
					Java Data Objects (JDO)</a></span> [version 2.3; while GAE supports JDO 3.0 as
			well, we continue to use JDO 2.3 because it is easier to set up.] <br>JDO
			is a standard interface for storing objects containing data into a
			database. The standard defines interfaces for annotating Java
			objects, retrieving objects with queries, and interacting with a
			database using transactions. An application that uses the JDO
			interface can work with different kinds of databases without using
			any database-specific code, including relational databases,
			hierarchical databases, and object databases.</li>
		<li><span class="bold">Datanucleus Access Platform</span>
			[version 1; while GAE supports Datanucleus v2 as well, the version
			that goes with JDO 2.3 is v1] <br>The DataNucleus Access
			Platform provides persistence and retrieval of data to a range of
			datastores using a range of APIs, with a range of query languages. <br>Comes
			with App Engine SDK.</li>
		<li><span class="bold">Xerces XML Parser</span> [version 2.9.1] <br />This
			library is required to parse the XML config files. This library may
			not be needed on some platforms as it may already come packaged on
			some JREs (particulary windows)</li>
	</ul>

	<h2 id="infrastructure-toolsandtechnologies-testing">Tools used in
		testing</h2>
	<ul>
		<li><span class="bold"><a
				href="http://code.google.com/p/selenium/wiki/UsingWebDriver">
					Selenium</a></span> [version 2.26.0] <br>Selenium automates browsers. We
			use it for automating our UI tests. <br>We require Selenium
			standalone server, Chrome driver, IE driver, and Java language
			bindings.</li>
		<li><span class="bold"><a
				href="http://www.oracle.com/technetwork/java/javamail/index.html">JavaMail</a></span>
			[version 1.4.5] <br>The JavaMail API provides a
			platform-independent and protocol-independent framework to build mail
			and messaging applications. <br> Usage: For accessing test
			users' email accounts to examine emails sent from TEAMMATES.</li>
		<li><span class="bold"><a
				href="http://testng.org/">TestNG</a></span> [version
			6.8.1] <br>TestNG is a Java test automation framework.</li>
		<li><span class="bold"><a href="http://qunitjs.com/">QUnit</a></span>
			[version 1.10.0] <br>QUnit is a JavaScript unit test suite.</li>
		<li><span class="bold">NekoHtml</span> [version 1.9.16] <br>NekoHTML
			is a simple HTML scanner and tag balancer that enables application
			programmers to parse HTML documents and access the information using
			standard XML interfaces. <br>NekoHTML is included in the
			Selenium libraries. <br>Usage: During UI testing, for doing a
			logical comparison of the pages generated against expected pages.</li>
	</ul>
	<h2 id="infrastructure-configpoints">Config points</h2>
	There are several files used to configure various aspects of the
	system.
	<ul>
		<li><span class="code"><span class="bold">build.properties
			</span></span>: This is the main general purpose configuration file.
		<li><span class="code"><span class="bold">logging.properties
			</span></span>: Configuration for java.util.logging users.
		<li><span class="code"><span class="bold">log4j.properties
			</span></span>: Configuration for log4j users. Not used by us.
		<li><span class="code"><span class="bold">test.properties
			</span></span>: Contains configuration values for the test driver.
		<li><span class="code"><span class="bold">appengine-web.xml
			</span></span>: Contains configuration for deploying the application on app engine.
		
		<li><span class="code"><span class="bold">web.xml </span></span>:
			This is the configurations for the webserver. It specifies servlets
			to run, mapping from URLs to servlets/JSPs, security constraints,
			etc.
		<li><span class="code"><span class="bold">cron.xml
			</span></span>: This specifies cron jobs to run.
		<li><span class="code"><span class="bold">queue.xml
			</span></span>: Specifies configuration of task queues.
		<li><span class="code"><span class="bold">jdoconfig.xml
			</span></span>: Specifies the JDO configuration.
		<li><span class="code"><span class="bold">persistence.xml
			</span></span>: auto-generated.
	</ul>

	<hr>
	<!-- =============================================================== -->

	<h1 id="settingup">Setting Up</h1>
	These instructions are for the Windows environment. Instructions for
	Mac OS is similar, with slight variations that you can figure out
	yourself.

	<h2 id="settingup-prerequisites">Prerequisites</h2>
	<ul>
		<li>Install the latest JDK.</li>
		<li>Install <a href="http://tortoisehg.bitbucket.org/">TortoiseHg</a>
			latest stable version. <br>If you are on Mac OS, you can install
			<a href="http://mercurial.selenic.com/">Mercurial (Commandline
				version)</a> or a Hg GUI such as <a
			href="http://jasonfharris.com/machg/">MacHg</a>.<br> Configure
			the user name in Hg global settings. The recommended format is <span
			class="code">Full name &lt;email&gt;</span> e.g. <span class="code">John
				Mayor &lt;john.m@gmail.com&gt; </span>
		</li>
		<li>Download <i>Eclipse IDE for Java EE Developers</i> (version:
			Juno) from <a href="http://www.eclipse.org/downloads/">http://www.eclipse.org/downloads/
		</a>
		</li>
		<li>Install <i>Google Plugin for Eclipse</i> version 4.2. Be
			careful to omit other plugins shown on the screen (e.g., Google App
			Engine Tools for Android, GWT plugin). <br>Instructions are at <a
			href="https://developers.google.com/eclipse/docs/install-eclipse-4.2">https://developers.google.com/eclipse/docs/install-eclipse-4.2</a>.
			<br>Note: Sometimes the update site for the GAE plug-in
			does not work. In which case, follow the instructions at <a
			href="https://developers.google.com/eclipse/docs/install-from-zip">https://developers.google.com/eclipse/docs/install-from-zip</a>.
		</li>
		<li>Install <i>Google App Engine SDK</i> version 1.7.7.1 <br>Instructions
			are at <a
			href="https://developers.google.com/eclipse/docs/using_sdks">https://developers.google.com/eclipse/docs/using_sdks</a>.
			<br>Download link to the SDK is <a
			href="http://googleappengine.googlecode.com/files/appengine-java-sdk-1.7.7.1.zip">http://googleappengine.googlecode.com/files/appengine-java-sdk-1.7.7.1.zip</a>.
		</li>
		<li>Install the latest <a
			href="http://testng.org/doc/eclipse.html"><i>TestNG Eclipse
					plugin</i></a>.
		</li>
		<li>If you plan to contribute code, also install Python 2.5+  (not version 3.x). 
		{Python is used by the patch uploader script}</li>
		<li>If you plan to use Firefox for testing TEAMMATES (alternatively, you may use
		Chrome or IE, but FF is the most convenient of the three), downgrade to
			Firefox 12.0 from <a
			href="https://ftp.mozilla.org/pub/mozilla.org/firefox/releases/">here</a>
			{The web driver for later Firefox doesn't work for our test cases.}
		</li>
	</ul>

	<h2 id="settingup-settingupdevserver">Setting up the dev server</h2>
	'Dev server' means running the server in localhost mode.
	<ol>
		<li>Clone the source code from: <span class="code"><a
				href="https://code.google.com/p/teammatespes/">https://code.google.com/p/teammatespes/</a></span>
			<br /> Note: If you are using TortoiseHg to clone, simply copy the
			URL above and paste it in the Source field. Alternatively, you can
			use the command line to do the cloning.
		</li>
		<li>Add the following section to the <span class="code">hgrc</span>
			file inside your project repo folder. {reason: to configure Mercurial
			Queue extension and EOL extension that we use for TEAMMATES.} <br>
			<span class="code">
				[extensions]<br> 
				#enable mercurial queue extension<br> 
				hgext.mq =<br> 
				#enable end-of-line extension<br> 
				eol =<br>
				[diff]<br> 
				# prevent qrefresh
				from updating timestamps<br> nodates=1<br> 
				# force all
				patches to always be in git format<br> 
				git=1<br>
			</span>
		</li>
		<li>Create config files {these are not under revision control
			because their content vary from developer to developer}.
			<ol type="a">
				<li><span class="code"><span class="blue">src/main/resources/</span><span
						class="bold">build.properties</span></span> <br> Use <span
					class="code">build.template.properties</span> as a template (i.e.
					copy → paste → rename)<br> For dev server testing, property
					values can remain as they are.</li>
				<li><span class="code"><span class="blue">src/test/resources/</span><span
						class="bold">test.properties </span></span> <br> Create it using <span
					class="code">test.template.properties</span> (in the same folder).
					For dev server testing, property values can remain as they are.</li>
				<li><span class="code"><span class="blue">src/main/webapp/WEB-INF/</span><span
						class="bold">appengine-web.xml</span></span> <br> Create using <span
					class="code">appengine-web.template.xml</span>. For dev server
					testing, property values can remain as they are.</li>
			</ol>
		</li>
		<li>Open Eclipse and import → general → 'existing projects into
			workspace' (see the <span class="bold">Troubleshooting</span> section
			below if encounter any problem). After the importing is complete,
			following settings should be applied automatically (they are here for
			reference only).
			<ol type="a">
				<li>Properties→Google→Web application
					<ol type="i">
						<li>'this project has a WAR directory' is selected.</li>
						<li>'Launch and deploy from this directory' points to <span
							class="code">src/main/webapp</span></li>
					</ol>
				</li>
				<li>Properties→Google→App engine
					<ol type="i">
						<li>'use Google App Engine' selected</li>
					</ol>
				</li>
				<li>Properties → Google → App Engine → ORM
					<ol type="i">
						<li>This is where we specify where are your Entity classes so
							that they can be enhanced by the DataNucleus Enhancer tool. Only
							the folder <span class="code bold">src/main/java/teammates/storage/entity/*.java</span>
							should appear in the list . That way, DataNucleus Enhancer runs
							only when you modify your entity classes.
						</li>
					</ol>
				</li>
				<li>Windows → Preferences → Java → Installed JRE
					<ol type="i">
						<li>Ensure a JDK (not a JRE) is selected. One of the items in
					the <a href="#settingup-troubleshooting">Troubleshooting</a>
					section below explains how to do this.
						</li>
					</ol>
				</li>
			</ol>
		</li>
		<li>Right-click on the project folder and choose 'Run' → 'As Web
			Application'. After some time, you should see this message on the
			console “The server is running at http://localhost:8888/”.<br>
			The dev server is now ready to start requests at the given URL. You
			can verify by visiting the URL in your Browser. <br>You can
			login to the system, you need to add yourself as an instructor first
			 (described below).
		</li>
	</ol>

	<h3>Adding instructor accounts</h3>
	<ol type="a">
		<li>Go to <span class="code">http://[appURL]/admin/adminHome
				(On your computer, it may be http://localhost:8888/admin/adminHome)</span></li>
		<li>Log in using your Google ID. If this is the dev server, enter
			any email address, but remember to check the 'log in as
			administrator' check box.</li>
		<li>Enter credentials for an instructor. e.g., <br> Google
			id: teammates.instructor<br> Name: Dr. John Adams <br>
			Email: teammates.instructor@gmail.com<br>
			Institute: National University of Singapore <br>
		</li>
	</ol>

	<h3>Running the test suite</h3>
	This can be done using the "All tests" option under the
	green "Run" button in the toolbar. If this option is not available
	(sometimes, Eclipse does not show this option immediately after you set
	up the project. In will appear in subsequent runs. 
	'Refreshing' will make it appear too.), run
	<span class="bold code">src/test/testing.xml</span> (right click and
	choose 'Run as → TestNG Suite'). Most of the tests should pass. <br> 
	If a few cases fail (this can happen due to timing issues), run the failed
	cases using the "Run Failed Test" icon in the TestNG tab in Eclipse until
	they pass. The default browser used for testing is the Firefox browser.
	Testing on the Firefox browser is relatively faster as compared to the
	other browsers, and it can be run in the background. 
	<br>
	<br> To change the browser that is used in the UI tests, go to the
	<span class="code">test.properties</span> file and change the
	<span class="code">test.selenium.browser</span> value to the browser
	you want to test. Possible values are
	<span class="code"> firefox, chrome, iexplore, safari.</span> In
	addition, you need to configure the browser you have selected so that
	it works with the test suite.
	<br>
	<br>
	<span class="bold">Firefox</span>
	<ul>
		<li>If you are planning to test changes to JavaScript code,
			disable javascript caching for Firefox - Enter "about:config" into
			the Firefox address bar and set: network.http.use-cache = false</li>
	</ul>
	<span class="bold">Chrome</span>
	<ul>
		<li>If you are planning to test changes to JavaScript code,
			disable javascript caching for Chrome - Press ctrl-shift-j to bring
			up the Web Console. At the bottom-right corner, there is a settings
			button. Click on that. Under the General tab, check 'Disable Cache'</li>
	</ul>
	<span class="bold">Internet Explorer</span>
	<ul>
		<li>If you are planning to test changes to JavaScript code,
			disable javascript caching for Internet Explorer - Go to Internet
			Options. On the General tab, under Browsing History click Settings.
			Select the "Every time I visit the webpage" radio button.</li>
		<li>Ensure that the browser zoom level is set to 100%</li>
		<li>Set the Protected Mode settings for each zone to be the same
			value. The value can be on or off, as long as it is the same for
			every zone. To set the Protected Mode settings, choose "Internet
			Options..." from the Tools menu, and click on the Security tab. For
			each zone, there will be a check box at the bottom of the tab labeled
			"Enable Protected Mode".</li>
	</ul>
	<span class="bold">Safari</span>
	<ul>
		<li>If you are planning to test changes to JavaScript code,
			disable javascript caching for Safari - Enable the Developer menu:
			Safari -> Preferences -> Advanced -> Show Develop menu in menu bar
			and select Disable Caches there.</li>
	</ul>

	<span class="bold">Note:</span> When testing with Chrome and Internet
	Explorer, the chromedriver process and the IEDriverServer process will
	not automatically get killed after the tests have finished executing.
	You will need to manually kill these processes after the tests are
	done. On Windows, you can do this using the Task Manager or 'tskill' DOS
	command.

	<h2 id="settingup-deployingtostagingserver">Deploying to staging
		server</h2>
	"Staging server" is the server instance you set up on Google App Engine
	for hosting the app for testing purposes.
	<ol>
		<li>Create your own app on GAE.<br> Suggested app name:
			teammates-name (replace the name with your own name). The URL of the
			app will be like this.<br> <span class="blue code">http://teammates-name.appspot.com</span><br>
		</li>
		<br>
		<li>Modify configuration files.
			<ol type="a">
				<li><span class="code"><span class="blue">src/main/resources/</span><span
						class="bold">build.properties </span></span><br> Follow instructions
					in the file itself.</li>
				<li><span class="code"><span class="blue">src/test/resources/</span><span
						class="bold">test.properties </span></span><br> Get from a project
					member details of Gmail accounts used for testing. Edit the
					file as instructed in its comments.</li>
				<li><span class="code"><span class="blue">src/main/webapp/WEB-INF/</span><span
						class="bold">appengine-web.xml </span></span><br> Modify to match
					app name and app id of your own app.</li>
			</ol>
		</li>
		<li>Deploy the application to an appspot
			<ol type="a">
				<li>Choose 'Deploy to app engine' from eclipse and follow the
					steps.</li>
				<li>Wait until you see this message in Eclipse console
					“Deployment completed successfully”</li>
				<li>Go to appengine dashboard <br> <span class="code">
						<span class="blue">https://appengine.google.com/dashboard?&app_id=teammates-</span><span
						class="red">name</span>
				</span></li>
				<li>Click “Versions” under “Main” menu on the left bar.</li>
				<li>Set the version you deployed as the 'default'.</li>
			</ol> Note: You can skip the steps to set the deployed version as the
			default. In that case, you can access the deployed app using <span
			class="code">http://{version}-dot-{app-id}.appspot.com</span> e.g. <span
			class="code">http://4-18-dot-teammates-john.appspot.com </span>
		</li>
		<li>You can run the tests again against the deployed app (modify
			<span class="code">test.properties</span> so that tests execute
			against the deployed app and not the dev server). <br> Note that
			GAE daily quota will be exhausted after 2-3 runs of the full test
			suite.
		</li>
	</ol>

	<h2 id="settingup-troubleshooting">Troubleshooting</h2>
	<ol>
		<li>ERROR: Eclipse complains about <span class="code">FileWriter</span>
			and <span class="code">ConsoleHandler</span> e.g. <span class="code">java.io.FileWriter
				is not supported by Google App Engine's Java runtime environment</span> <br>
			SOLUTION: These are OK because the offending files belong to test
			driver and will not be deployed to GAE. Choose to 'Quick Fix' and
			then choose to exclude those files from validation.
		</li>
		<br>
		<li>ERROR: Eclipse complains <span class="code">"...your
				project must be configured to use a jdk in order to use jsp"</span>. <br>
			SOLUTION: This happens because Eclipse is only aware of JRE, not JDK
			(Compiling JSP requires the JDK). Go to
			Window→Preferences→Java→Installed JREs. You will note that a JRE path
			is the one selected, not a JDK path. To fix this, Click add→Standard
			VM, then for the JRE Path enter the path of the <span class="code">jre</span>
			folder inside your jdk installation folder. e.g., <span class="code">C:\jdk1.7\jre</span>
			Now you should see all of the JARs added to the library section.
		</li>
		<br>
		<li>ERROR: When trying to deoply, Eclipse complains <span
			class="code">"...Unable to update app: Cannot get the System
				Java Compiler. Please use a JDK, not a JRE."</span>. <br> SOLUTION:
			You can force Eclipse to use the JDK (instead of JRE) by modifiying
			the <span class="code">eclipse.ini</span> file. See <a
			href="http://stackoverflow.com/questions/13913019/changing-jdk-in-eclipse">here</a>
			for more details.
		</li>
		<br>
		<li>ERROR (on Windows): Dev server launched by Eclipse keeps
			running even after closing Eclipse. After restarting Eclipse, you'll
			be able to relaunch dev server on the same port but requests will be
			received by the previous server instance.<br> SOLUTION: If
			Eclipse crashes while development server is running inside Eclipse,
			the server might keep running even after Eclipse is closed. Go to
			Windows Task Manager and kill processes named javaw.exe.
		</li>
		<br>
		<li>ERROR (on Windows), <span class="code">NullPointerException</span>
			when trying to access email box. The error message looks something
			like this:<br> <span class="code">java.lang.NullPointerException
				at <br>
				javax.mail.internet.ParameterList.set(ParameterList.java:165) at <br>
				com.sun.mail.imap.protocol.BODYSTRUCTURE.parseParameters(BODYSTRUCTURE.java:390)<br>
		</span> SOLUTION: In eclipse, move the <span class="code">javax.mail.....jar</span>
			(from Oracle) to the top of the build class path. (Properties → Java
			build path → 'order and export' tab)
		</li>
		<br>
		<li>ERROR: Eclipse complains "file out of sync".<br>
			SOLUTION: 'refresh' the project in eclipse.
		</li>
		<br>
		<li>ERROR: Tests fail randomly during dev server testing.<br>
			SOLUTION: Make sure there is only one dev server running. Eclipse
			will happily allow you to start multiple dev servers.
		</li>
		<br>
		<li>ERROR: Eclipse complains "<span class="code">There are
				no JREs installed in the workplace that are strictly compatible with
				this environment.</span>"<br> SOLUTION: Eclipse may be using an
			incompatible version of the JRE Library (with respect to TEAMMATES)
			for the current JRE definition. System Library for JRE should be set
			to the workspace default, after appropriate JRE definition has been
			added (covered in existing point#2 of the troubleshooting section).<br>
			-> Right-click on project<br> -> Properties<br> -> Java
			Build Path<br> -> "Libraries" tab<br> -> Select JRE System
			Library from the list<br> -> Edit...<br> -> Select and mark
			radio button for "Workspace default JRE"
		</li>
		<br>
		<li>ERROR: Test failure message encountered when running full
			test suite: “Selenium cannot find Firefox binary in PATH”.<br>
			SOLUTION: Path to Firefox executable on local machine is incorrect.
			Specify the correct folder in system PATH variable.<br> -> Open
			Windows Explorer<br> -> Right-click on Computer<br> ->
			Advanced System Settings<br> -> “Advanced” tab<br> ->
			Environment Variables…<br> -> Select “PATH” from the list<br>
			-> Add directory of “Mozilla Firedox” folder to “Variable value”
			field
		</li>
		<br>
		<li>ERROR: A handful of failed test cases (<10)<br>
			SOLUTION: Ensure compatible version of Firefox is installed as
			specified under <a href="#settingup-prerequisites">Prerequisites</a>.
		</li>
		<br>
		<li>ERROR: Browser alert about invalid ssl certificate.<br/>
			SOLUTION: Ensure that your url uses -dot- instead of '.' when using secondary subdomains.<br/>
			Eg. http\://4-30-dot-teammates-john.appspot.com <br/>
		</li>
	</ol>

	<hr>
	<!-- =============================================================== -->

	<h1 id="process">Process</h1>

	<h2 id="process-roles">Roles</h2>

	<ul>
		<li><span class="bold">Dev</span> - Issue owner who fixes the
			issue. Can be a <span class="bold">Committer</span> or a <span
			class="bold">Contributor</span>.</li>
		<li><span class="bold">Reviewer</span> - Assigned per issue.
			Usually, a core team member.</li>
		<li><span class="bold">Team lead</span> - Responsible for keeping
			all tests green, applying patches.</li>
		<li><span class="bold">PM</span> (Project Manager) - General
			project coordination and deploying to live server</li>
	</ul>

	<h2 id="process-workflow">Workflow</h2>

	<div class="image-holder">
		<img src="images/workflow.png" width=90% />
	</div>

	<h2 id="process-fixingissues">Fixing Issues</h2>
	Role: Dev
	<br>
	<br> {If you need any help regarding the workflow, please post in
	the
	<a
		href="https://groups.google.com/forum/?fromgroups#!forum/teammates-contributors">teammates-contributors
		Google group</a>.}
	<ol>
		<li>Select an issue to handle. Get it assigned to you.
			Contributors can request for an issue to be assigned to you by
			posting a comment under the issue in concern.</li>
		<br>
		<li>Optionally, you can discuss alternative solutions before
			choosing one to implement. This can be done through Issue tracker or
			email group. Such a discussion reduces the chance of the fix being
			rejected later.</li>
		<br>
		<li>Mark the issue as <span class="code">Started</span>.
		</li>
		<br>
		<li>Update your local repo (the one you created when setting up
			the project on your computer) with the latest version of the code
			from the committer repo. <br> <span class="code"> hg pull
				https://code.google.com/p/teammatespes/ <br> hg update
		</span>
		</li>
		<br>
		<li>Start a new branch named <span class="code">Issue{IssueNumber}</span>.
			If you are already working in a branch, remember to switch to trunk
			(i.e. <span class="code">default</span> branch) before creating the
			new branch. e.g., <br> <span class="code"> #switch to
				trunk (if required)<br> hg update default<br> #create new
				branch<br> hg branch {issue number} <br> #e.g. hg branch
				Issue236
		</span>
		</li>
		<br>
		<li>Fix the issue. <br>You may commit as many times as you
			wish while you are fixing the code. These commits are for your own
			use and will not be visible to others. Once you are done with fixing
			the issue, we package the commits as a single patch before uploading
			to Rietveld (our code review system).
		</li>
		<br>
		<li>When the work is ready for review:
			<ol type="a">
				<li>Sync with the committer repo: While you were fixing the
					issue, others might have pushed new code to the committer repo. In
					that case, update your repo with any new changes from committer
					repo and merge those updates to your branch<br> <span
					class="code"> hg pull
						https://code.google.com/p/teammatespes/<br> 
						hg update<br>
						hg merge default<br> 
						hg commit -m "your commit message"
				</span>
				</li>
				<li>Format the code: Select the code segments you modified and apply
					the code formatting function of Eclipse (Source --> Format). This
					is to ensure that the code is properly formatted. You may tweak the
					code further to improve readability as auto-format doesn't always
					result in a good layout.<br></li>
				<li>Ensure dev green (i.e., all tests are passing on dev
					server).</li>
				<li>If your new code might behave differently on a remote
					server than how it behaves on the dev server, ensure staging green
					(i.e., all tests are passing against the modified app running on
					your own GAE staging server).</li>
				<li>Upload the changes as a patch to code review system. <br>
					<span class="code">upload.py --rev=default -t Issue "{issue
						number} : {branch description as given in Issue tracker}"<br>
						#e.g., upload.py --rev=default -t "Issue 829 : Remoe unused
						constants from Attributes classes"
				</span><br> See <a
					href="https://code.google.com/p/rietveld/wiki/UploadPyUsage">here</a>
					for more about <span class="code">upload.py</span> usage.<br>
				</li>
				<li>Change Issue status to <span class="code">ReadyForReview</span>.
					In the 'comments' text box, specify the direct URL (here is <a
					href=https://codereview.appspot.com/9045043/">an example URL</a>)
					to the issure created on the <a
					href="https://codereview.appspot.com">code review system</a>. This
					way, the reviewer can reach your new code in one click. 
				</li>
			</ol>
		</li>
		<br>
		<li>Repeat above two steps until the Issue is marked as <span
			class="code">ReadyToMerge</span> by the reviewer. If the Issue is
			marked as <span class="code">ChangesRequired</span>, you need to do
			further changes based on comments reviewer added in the code review 
			system. When uploading another patch to an existing issue, you need 
			to add the following option to the upload command in order to add the
			new patch to the existing issue in the code review system.
			<br><span class="code">-i {issue number from the code review system 
			(not from our issue tracker)} <br>
			#example
			<br>upload.py --rev=default -t "Issue 829 : Remoe unused constants from Attributes classes" 
			<span class="bold">-i 9045043 </span>
			</span>                   
		</li>
	</ol>
	<br>

	<h2 id="process-reviewingafix">Reviewing a fix</h2>
	Role: reviewer
	<br>
	<br> This is a static code review. No need to apply fix or run
	tests.
	<br> Add comments in the contributor repo or in the committer repo
	(as appropriate).
	<br>
	<br> Try to make sure
	<br> a) The solution is optimal.
	<br> b) The code is of acceptable quality.
	<br> c) Tests have enough coverage.
	<br> d) Appropriate documentation have been updated (if
	applicable). DevMan, Spec, Analysis doc, Help pages, and the Features
	page are some pages that might need updating.
	<br>
	<br> Try to finish the review within a day of submission.
	<br> Once the review is done, publish your comments. If the code
	is ready for release, change the status to
	<span class="code">ReadyToMerge</span> and ask the team lead to merge
	the branch.
	<br>If the code is not ready for release, change the status to
	<span class="code">ChangesRequested</span>.

	<h2 id="process-applyingafix">Applying a fix</h2>
	Role: team lead
	<ol>
		<li>Pull the latest code from the committer repo</li>
		<li> Download the patch from Rietveld@GoogleCode to the project root folder.</li>
		<li>Apply the patch.<br> <span class="code">hg import patch_file_name --no-commit</span>
		</li>
		<br>
		<li>Verify 'dev green'. If the change does not involve automated
			tests, do a manual test. e.g., changes to documentation.</li>
		<br>
		<li>Verify 'staging green' (i.e. use your own app on appengine as
			the 'staging site') if the changed code could potentially behave
			differently on a remote server.</li>
		<br>
		<li>If not green: <br>
			<ul>
				<li>Inform Developer of any broken code by changing the Issue status.</li>
				<li>Remove the patch from your local repo.
					<br> <span class="code">hg -revert --all</span>
				</li>
			</ul> <br> If green:
			<ul>
				<li>Commit the patch. The commit message should be<br> 
				<span class="code">Issue {issue number} : {branch description as given in Issue tracker} <br>
				Update Issue {issue number}	</span><br>
				Example:<br>
				<span class="code">Issue 829 : Remoe unused constants from *Attributes classes <br>
				Update Issue 829	</span>
				</li>
				<li>Push the merged branch to the committer repo. <br> <span
					class="code">hg push {committer repo URL} -b
						defalut </span>
				</li>
			</ul>
		</li>
		<br>
		<li>Set issue status to <span class="code">Delivered</span>.
		</li>
	</ol>

	<h2 id="process-deployingfixes">Deploying fixes</h2>
	Role: PM
	<ol>
		<li>Deploy to live site as a new version.<br> Version
			numbering is x.yy.zz (x-yy-zz on GAE because GAE does not allow '.')
			<br> x: major version, yy: feature release, zz: builds for
			feature yy or updates that doesn't affect functionality<br>
			e.g., 4.01.02
		</li>
		<br>
		<li>Verify 'live green'.</li>
		<br>
		<li>Set new version as default.</li>
		<br>

		<li>Mark issues as <span class="code">Deployed</span></li>
		<li>Update version history</li>
		<li>Tag repo with version number<br> <span class="code">hg
				tag V4.18</span>
		</li>
		<li>Push to the contributor repo (to send the tag to the repo).<br>
	</ol>

	<h2 id="process-issuelifecycle">Issue Lifecycle</h2>
	<span class="bold">Issue classification:</span>
	<ul>
		<li><span class="bold">Urgent</span>: would like to handle in the
			very next release.</li>
		<li><span class="bold">High</span>: enhances user experience
			significantly, would like to do in the next few releases.</li>
		<li><span class="bold">Medium</span>: marginal impact on user
			experience.</li>
		<li><span class="bold">Low</span>: very little impact, unlikely
			to do in the near future.</li>
	</ul>

	<div class="image-holder">
		<img src="images/IssueLifecycle.png" width="90%" />
	</div>

	Given above is an illustration of the issue lifecycle. Colors indicate
	which roles are involved in which states/transitions. Click on the
	'status' text box in the
	<a href="http://code.google.com/p/teammatespes/issues/entry">'new
		issue'</a> template in the Issue Tracker for a description of each status.
	<br>

	<hr>
	<!-- =============================================================== -->

	<h1 id="glossary">Glossary</h1>
	<ul>
		<li><span class="bold">Course</span>: we use 'course' to mean
			'module', 'class'. A course here means an offering of a course in a
			particular semester/term. If the course is offered twice in two
			semesters, they are considered two courses.</li>
		<li><span class="bold">Contribution scale</span>:<br> <span
			class="blue"> [equal share]+100%<br> [equal share]+90%<br>
				...<br> [equal share]<br> [NOT SURE]<br> [equal
				share]-10%<br> ...<br> [equal share]-90%<br> [0%]
				(did nothing at all)<br>
		</span></li>
		<li><span class="bold">DevMan</span>: Developer manual (this
			document)</li>
		<li><span class="bold">DevSite</span>: <a
			href='http://teammatespes.gogolecode.com'>Our developer web site</a></li>
		<li><span class="bold">Dev green</span>: All tests are passing on
			the dev server (i.e. localhost)</li>
		<li><span class="bold">Enrollment, Enroll </span>(NOT enrolment,
			enrol)</li>
		<li><span class="bold">Live green</span>: All tests are passing
			on live app</li>
		<li><span class="bold">Spec</span>: System Specification</li>
		<li><span class="bold">Staging green</span>: All test are passing
			against you own deployment on the GAE</li>
	</ul>
	<br> ---End of document---

</body>
</html>


